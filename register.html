<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">S'inscrire - Xeltis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --xeltis-gold: #FFD700;
            --xeltis-dark: #000000;
            --xeltis-white: #FFFFFF;
            --xeltis-gray-light: #F3F2EF;
            --xeltis-gray-medium: #CED0D4;
            --xeltis-text-dark: #1F2937;
            --xeltis-text-medium: #4B5563;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--xeltis-dark);
            color: var(--xeltis-white);
        }

        .form-input-xeltis {
            border: 1px solid var(--xeltis-gray-medium);
            border-radius: 6px;
            padding: 12px 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
            background-color: var(--xeltis-white);
            color: var(--xeltis-text-dark);
        }

        .form-input-xeltis:focus {
            border-color: var(--xeltis-gold);
            box-shadow: 0 0 0 1px var(--xeltis-gold);
            outline: none;
        }

        .btn-primary-xeltis {
            background-color: var(--xeltis-gold);
            color: var(--xeltis-dark);
            border-radius: 20px;
            padding: 12px 24px;
            font-weight: 600;
            transition: background-color 0.2s;
            text-align: center;
            border: none;
            cursor: pointer;
            display: inline-block;
            text-decoration: none;
        }

        .btn-primary-xeltis:hover {
            background-color: #E6C200;
        }

        .btn-primary-xeltis:disabled {
            background-color: #A0AEC0;
            cursor: not-allowed;
            color: #6B7280;
        }

        .xeltis-logo-container {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .xeltis-logo {
            max-width: 120px;
            height: auto;
            display: inline-block;
        }

        .card-xeltis {
            background-color: var(--xeltis-white);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 2.5rem;
        }

        .link-xeltis {
            color: var(--xeltis-gold);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
        }

        .link-xeltis:hover {
            text-decoration: underline;
            color: #E6C200;
        }

        .message-box {
            border-radius: 6px;
            padding: 1rem;
            font-weight: 500;
            text-align: center;
            margin-top: 1rem;
        }

        .message-box.success {
            background-color: #d1fae5;
            color: #065f46;
        }

        .message-box.error {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            background-color: var(--xeltis-white);
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease-in-out;
        }

        .modal-overlay.open .modal-container {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--xeltis-text-dark);
        }

        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex-grow: 1;
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid #e2e8f0;
            text-align: right;
        }

        .btn-modal-accept {
            background-color: var(--xeltis-gold);
            color: var(--xeltis-dark);
            border-radius: 20px;
            padding: 10px 20px;
            font-weight: 600;
            transition: background-color 0.2s;
            border: none;
            cursor: pointer;
        }

        .btn-modal-accept:hover {
            background-color: #E6C200;
        }

        #languageSelector {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background-color: #2D3748;
            color: var(--xeltis-white);
            cursor: pointer;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="languageSelector" class="hover:bg-gray-700 transition">EN</div>

    <div class="w-full max-w-4xl">
        <div class="xeltis-logo-container">
            <img src="xeltis-logo-CIxL2od-.png" alt="Xeltis Logo" class="xeltis-logo">
            <h1 class="text-3xl font-bold text-gray-100 mt-4" data-i18n="createAccountHeader">Créer votre compte Xeltis</h1>
            <p class="text-gray-300 mt-2" data-i18n="createAccountSubheader">Rejoignez la plateforme Xeltis et faites partie de l'avenir du commerce des minéraux.</p>
        </div>

        <div class="card-xeltis">
            <form id="registrationForm" class="space-y-6 text-gray-700">
                <h2 class="text-xl font-semibold text-gray-900 border-b pb-2 mb-4" data-i18n="personalInfoHeader">1. Informations personnelles</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="fullName" class="block text-sm font-medium mb-1" data-i18n="fullNameLabel">Nom complet</label>
                        <input type="text" name="fullName" id="fullName" class="form-input-xeltis w-full" data-i18n="placeholderFullName" placeholder="Jean Dupont" required />
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium mb-1" data-i18n="emailLabel">Adresse e-mail</label>
                        <input type="email" name="email" id="email" class="form-input-xeltis w-full" data-i18n="placeholderEmail" placeholder="vous@exemple.com" required />
                    </div>
                    <div>
                        <label for="phoneNumber" class="block text-sm font-medium mb-1" data-i18n="phoneNumberLabel">Numéro de téléphone</label>
                        <input type="tel" name="phoneNumber" id="phoneNumber" class="form-input-xeltis w-full" data-i18n="placeholderPhoneNumber" placeholder="+1234567890" required />
                    </div>
                    <div>
                        <label for="country" class="block text-sm font-medium mb-1" data-i18n="countryLabel">Pays / Région</label>
                        <select name="country" id="country" class="form-input-xeltis w-full" required>
                            <option value="" disabled selected data-i18n="placeholderCountry">Sélectionnez votre pays</option>
                        </select>
                    </div>
                    <div>
                        <label for="city" class="block text-sm font-medium mb-1" data-i18n="cityLabel">Ville</label>
                        <input type="text" name="city" id="city" class="form-input-xeltis w-full" data-i18n="placeholderCity" placeholder="e.g., Johannesburg" required />
                    </div>
                    <div>
                        <label for="dateOfBirth" class="block text-sm font-medium mb-1" data-i18n="dateOfBirthLabel">Date de naissance</label>
                        <input type="date" name="dateOfBirth" id="dateOfBirth" class="form-input-xeltis w-full" required />
                    </div>
                </div>

                <h2 class="text-xl font-semibold text-gray-900 border-b pb-2 mb-4 mt-8" data-i18n="accountSecurityHeader">2. Sécurité du compte</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="password" class="block text-sm font-medium mb-1" data-i18n="passwordLabel">Créer un mot de passe</label>
                        <div class="relative">
                            <input type="password" name="password" id="password" class="form-input-xeltis w-full pr-10" required data-i18n="placeholderPassword" placeholder="Entrez un mot de passe fort" />
                            <span id="togglePassword" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 cursor-pointer">
                                <i class="fa-solid fa-eye-slash"></i>
                            </span>
                        </div>
                    </div>
                    <div>
                        <label for="confirmPassword" class="block text-sm font-medium mb-1" data-i18n="confirmPasswordLabel">Confirmer le mot de passe</label>
                        <div class="relative">
                            <input type="password" name="confirmPassword" id="confirmPassword" class="form-input-xeltis w-full pr-10" required data-i18n="placeholderConfirmPassword" placeholder="Confirmez votre mot de passe" />
                            <span id="toggleConfirmPassword" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 cursor-pointer">
                                <i class="fa-solid fa-eye-slash"></i>
                            </span>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label for="idPassport" class="block text-sm font-medium mb-1" data-i18n="idPassportLabel">Télécharger la pièce d'identité / le passeport (pour vérification)</label>
                        <input type="file" name="idPassport" id="idPassport" accept="image/*,.pdf" class="form-input-xeltis w-full pt-2" />
                        <p class="text-xs text-gray-500 mt-1" data-i18n="idPassportHelp">Formats acceptés : images (.jpg, .png) ou PDF. Taille max 5MB.</p>
                    </div>
                </div>

                <h2 class="text-xl font-semibold text-gray-900 border-b pb-2 mb-4 mt-8" data-i18n="miningRoleHeader">3. Rôle dans l'industrie minière</h2>
                <div>
                    <label for="miningRole" class="block text-sm font-medium mb-1" data-i18n="miningRolesLabel">Veuillez sélectionner votre rôle dans l'industrie minière</label>
                    <select name="miningRole" id="miningRole" class="form-input-xeltis w-full" required>
                        <option value="" disabled selected data-i18n="placeholderMiningRoles">Sélectionner un rôle...</option>
                    </select>
                </div>

                <div id="companyDetailsSection" class="space-y-6 hidden">
                    <h2 class="text-xl font-semibold text-gray-900 border-b pb-2 mb-4 mt-8" data-i18n="companyDetailsHeader">4. Détails de l'entreprise / organisation</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="companyName" class="block text-sm font-medium mb-1" data-i18n="companyNameLabel">Nom de l'entreprise/organisation</label>
                            <input type="text" name="companyName" id="companyName" class="form-input-xeltis w-full" data-i18n="placeholderCompanyName" placeholder="e.g., GeoMining Corp" />
                        </div>
                        <div>
                            <label for="companyType" class="block text-sm font-medium mb-1" data-i18n="companyTypeLabel">Type</label>
                            <select name="companyType" id="companyType" class="form-input-xeltis w-full">
                                <option value="" disabled selected data-i18n="placeholderSelectType">Sélectionner le type</option>
                                <option value="Private" data-i18n="companyTypePrivate">Privé</option>
                                <option value="Public" data-i18n="companyTypePublic">Public</option>
                                <option value="NGO" data-i18n="companyTypeNGO">ONG</option>
                                <option value="Government" data-i18n="companyTypeGovernment">Gouvernement</option>
                                <option value="Other" data-i18n="companyTypeOther">Autre</option>
                            </select>
                        </div>
                        <div>
                            <label for="countryOfOperation" class="block text-sm font-medium mb-1" data-i18n="countryOfOperationLabel">Pays d'opération</label>
                            <select name="countryOfOperation" id="countryOfOperation" class="form-input-xeltis w-full">
                                <option value="" disabled selected data-i18n="placeholderCountryOfOperation">Sélectionnez le pays d'opération</option>
                            </select>
                        </div>
                        <div>
                            <label for="numEmployees" class="block text-sm font-medium mb-1" data-i18n="numEmployeesLabel">Nombre d'employés</label>
                            <input type="number" name="numEmployees" id="numEmployees" class="form-input-xeltis w-full" data-i18n="placeholderNumEmployees" placeholder="e.g., 50" />
                        </div>
                        <div class="md:col-span-2">
                            <label for="companyWebsite" class="block text-sm font-medium mb-1" data-i18n="companyWebsiteLabel">Site Web <span class="text-gray-500 font-normal" data-i18n="optionalText">(si applicable)</span></label>
                            <input type="url" name="companyWebsite" id="companyWebsite" class="form-input-xeltis w-full" placeholder="https://www.exemple.com" />
                        </div>
                    </div>
                </div>

                <h2 class="text-xl font-semibold text-gray-900 border-b pb-2 mb-4 mt-8" data-i18n="miningActivityHeader">5. Détails de l'activité minière</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="mineralsExtracted" class="block text-sm font-medium mb-1" data-i18n="mineralsExtractedLabel">Types de minéraux extraits / intéressés</label>
                        <input type="text" name="mineralsExtracted" id="mineralsExtracted" class="form-input-xeltis w-full" data-i18n="placeholderMineralsExtracted" placeholder="e.g., Or, Cuivre, Lithium" required />
                    </div>
                    <div>
                        <label for="operationsLocation" class="block text-sm font-medium mb-1" data-i18n="operationsLocationLabel">Emplacement(s) des opérations</label>
                        <input type="text" name="operationsLocation" id="operationsLocation" class="form-input-xeltis w-full" data-i18n="placeholderOperationsLocation" placeholder="e.g., Coordonnées GPS ou région" required />
                    </div>
                    <div>
                        <label for="annualProduction" class="block text-sm font-medium mb-1" data-i18n="annualProductionLabel">Production annuelle / Capacité d'investissement <span class="text-gray-500 font-normal" data-i18n="optionalText">(si applicable)</span></label>
                        <input type="text" name="annualProduction" id="annualProduction" class="form-input-xeltis w-full" data-i18n="placeholderAnnualProduction" placeholder="e.g., 500 kg par an" />
                    </div>
                    <div>
                        <label for="equipmentUsed" class="block text-sm font-medium mb-1" data-i18n="equipmentUsedLabel">Équipement possédé / utilisé</label>
                        <input type="text" name="equipmentUsed" id="equipmentUsed" class="form-input-xeltis w-full" data-i18n="placeholderEquipmentUsed" placeholder="e.g., Excavateurs, foreuses" />
                    </div>
                </div>

                <h2 class="text-xl font-semibold text-gray-900 border-b pb-2 mb-4 mt-8" data-i18n="experienceExpertiseHeader">6. Expérience & Expertise</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="yearsInSector" class="block text-sm font-medium mb-1" data-i18n="yearsInSectorLabel">Années dans le secteur minier</label>
                        <input type="number" name="yearsInSector" id="yearsInSector" class="form-input-xeltis w-full" data-i18n="placeholderYearsInSector" placeholder="e.g., 5" />
                    </div>
                    <div>
                        <label for="licenses" class="block text-sm font-medium mb-1" data-i18n="licensesLabel">Certifications / Licences</label>
                        <input type="text" name="licenses" id="licenses" class="form-input-xeltis w-full" data-i18n="placeholderLicenses" placeholder="e.g., Certificat de directeur de mine" />
                    </div>
                    <div class="md:col-span-2">
                        <label for="expertise" class="block text-sm font-medium mb-1" data-i18n="expertiseLabel">Domaines d'expertise</label>
                        <input type="text" name="expertise" id="expertise" class="form-input-xeltis w-full" data-i18n="placeholderExpertise" placeholder="e.g., Exploration, Extraction, Logistique" />
                    </div>
                </div>

                <h2 class="text-xl font-semibold text-gray-900 border-b pb-2 mb-4 mt-8" data-i18n="interestsHeader">7. Intérêts & Utilisation de la plateforme</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-1" data-i18n="interestedInLabel">Intéressé par :</label>
                        <div class="space-y-2">
                            <label><input type="checkbox" name="interest" value="Buying" class="mr-2" /> <span data-i18n="interestBuying">Achat</span></label>
                            <label><input type="checkbox" name="interest" value="Selling" class="mr-2" /> <span data-i18n="interestSelling">Vente</span></label>
                            <label><input type="checkbox" name="interest" value="Networking" class="mr-2" /> <span data-i18n="interestNetworking">Réseautage</span></label>
                            <label><input type="checkbox" name="interest" value="Research" class="mr-2" /> <span data-i18n="interestResearch">Recherche</span></label>
                            <label><input type="checkbox" name="interest" value="Investment" class="mr-2" /> <span data-i18n="interestInvestment">Investissement</span></label>
                            <label><input type="checkbox" name="interest" value="Equipment Supply" class="mr-2" /> <span data-i18n="interestEquipment">Fourniture d'équipement</span></label>
                            <label><input type="checkbox" name="interest" value="Collaboration" class="mr-2" /> <span data-i18n="interestCollaboration">Collaboration</span></label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1" data-i18n="notificationMethodLabel">Méthode de notification préférée :</label>
                        <div class="space-y-2">
                            <label><input type="radio" name="notificationMethod" value="Email" class="mr-2" checked /> <span data-i18n="notificationEmail">E-mail</span></label>
                            <label><input type="radio" name="notificationMethod" value="SMS" class="mr-2" /> <span data-i18n="notificationSMS">SMS</span></label>
                            <label><input type="radio" name="notificationMethod" value="In-App" class="mr-2" /> <span data-i18n="notificationInApp">Dans l'application</span></label>
                        </div>
                    </div>
                </div>

                <h2 class="text-xl font-semibold text-gray-900 border-b pb-2 mb-4 mt-8" data-i18n="termsConsentHeader">8. Termes & Consentement</h2>
                <div class="space-y-2">
                    <div>
                        <label class="text-sm">
                            <input type="checkbox" name="agreeTerms" id="agreeTerms" required class="mr-2" />
                            <span data-i18n="agreeTermsText">J'accepte les</span> <a href="#" id="viewTerms" class="link-xeltis" data-i18n="termsOfServiceLink">Conditions d'utilisation</a>
                        </label>
                    </div>
                    <div>
                        <label class="text-sm">
                            <input type="checkbox" name="agreePrivacy" id="agreePrivacy" required class="mr-2" />
                            <span data-i18n="agreePrivacyText">J'accepte la</span> <a href="#" id="viewPrivacy" class="link-xeltis" data-i18n="privacyPolicyLink">Politique de confidentialité</a>
                        </label>
                    </div>
                    <div>
                        <label class="text-sm">
                            <input type="checkbox" name="dataVerification" id="dataVerification" required class="mr-2" />
                            <span data-i18n="dataVerificationText">Je consens à la vérification des données</span>
                        </label>
                    </div>
                </div>

                <div id="messageBox" class="hidden"></div>

                <div class="pt-4">
                    <button type="submit" id="registerButton" class="w-full btn-primary-xeltis" data-i18n="registerButtonText">Créer un compte</button>
                </div>
            </form>
            <div class="mt-8 text-center">
                <p class="text-sm text-gray-700" data-i18n="alreadyAccountPrompt">
                    Vous avez déjà un compte ?
                    <a href="login.html" class="btn-primary-xeltis" data-i18n="signInLink">Connectez-vous</a>
                </p>
            </div>
        </div>
        <p class="text-xs text-gray-500 text-center mt-8">
            &copy; <span id="currentYear"></span> Xeltis. <span data-i18n="copyrightText">Tous droits réservés.</span>
        </p>
    </div>

    <div id="policyModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="policy-modal-close-button text-gray-700" onclick="document.getElementById('policyModal').classList.remove('open');">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <p class="text-center text-gray-500" data-i18n="loadingText">Chargement...</p>
            </div>
            <div class="modal-footer">
                <button id="modalAcceptBtn" class="btn-modal-accept" data-i18n="acceptButtonText">Accepter & Continuer</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const translations = {
            fr: {
                pageTitle: "S'inscrire - Xeltis",
                createAccountHeader: "Créer votre compte Xeltis",
                createAccountSubheader: "Rejoignez la plateforme Xeltis et faites partie de l'avenir du commerce des minéraux.",
                personalInfoHeader: "1. Informations personnelles",
                fullNameLabel: "Nom complet",
                placeholderFullName: "Jean Dupont",
                emailLabel: "Adresse e-mail",
                placeholderEmail: "vous@exemple.com",
                phoneNumberLabel: "Numéro de téléphone",
                placeholderPhoneNumber: "+1234567890",
                countryLabel: "Pays / Région",
                placeholderCountry: "Sélectionnez votre pays",
                cityLabel: "Ville",
                placeholderCity: "e.g., Johannesburg",
                dateOfBirthLabel: "Date de naissance",
                accountSecurityHeader: "2. Sécurité du compte",
                passwordLabel: "Créer un mot de passe",
                placeholderPassword: "Entrez un mot de passe fort",
                confirmPasswordLabel: "Confirmer le mot de passe",
                placeholderConfirmPassword: "Confirmez votre mot de passe",
                idPassportLabel: "Télécharger la pièce d'identité / le passeport (pour vérification)",
                idPassportHelp: "Formats acceptés : images (.jpg, .png) ou PDF. Taille max 5MB.",
                miningRoleHeader: "3. Rôle dans l'industrie minière",
                miningRolesLabel: "Veuillez sélectionner votre rôle dans l'industrie minière",
                placeholderMiningRoles: "Sélectionner un rôle...",
                miningRoles: [
                    "Mineur artisanal",
                    "Compagnie minière industrielle/internationale",
                    "Compagnie minière locale",
                    "Géologue / Chercheur",
                    "Fournisseur d'équipement",
                    "Investisseur / Financier",
                    "Fournisseur de logistique / transport",
                    "Fonctionnaire réglementaire / gouvernemental"
                ],
                companyDetailsHeader: "4. Détails de l'entreprise / organisation",
                optionalText: "(si applicable)",
                companyNameLabel: "Nom de l'entreprise/organisation",
                placeholderCompanyName: "e.g., GeoMining Corp",
                companyTypeLabel: "Type",
                placeholderSelectType: "Sélectionner le type",
                companyTypePrivate: "Privé",
                companyTypePublic: "Public",
                companyTypeNGO: "ONG",
                companyTypeGovernment: "Gouvernement",
                companyTypeOther: "Autre",
                countryOfOperationLabel: "Pays d'opération",
                placeholderCountryOfOperation: "Sélectionnez le pays d'opération",
                numEmployeesLabel: "Nombre d'employés",
                placeholderNumEmployees: "e.g., 50",
                companyWebsiteLabel: "Site Web",
                miningActivityHeader: "5. Détails de l'activité minière",
                mineralsExtractedLabel: "Types de minéraux extraits / intéressés",
                placeholderMineralsExtracted: "e.g., Or, Cuivre, Lithium",
                operationsLocationLabel: "Emplacement(s) des opérations",
                placeholderOperationsLocation: "e.g., Coordonnées GPS ou région",
                annualProductionLabel: "Production annuelle / Capacité d'investissement",
                placeholderAnnualProduction: "e.g., 500 kg par an",
                equipmentUsedLabel: "Équipement possédé / utilisé",
                placeholderEquipmentUsed: "e.g., Excavateurs, foreuses",
                experienceExpertiseHeader: "6. Expérience & Expertise",
                yearsInSectorLabel: "Années dans le secteur minier",
                placeholderYearsInSector: "e.g., 5",
                licensesLabel: "Certifications / Licences",
                placeholderLicenses: "e.g., Certificat de directeur de mine",
                expertiseLabel: "Domaines d'expertise",
                placeholderExpertise: "e.g., Exploration, Extraction, Logistique",
                interestsHeader: "7. Intérêts & Utilisation de la plateforme",
                interestedInLabel: "Intéressé par :",
                interestBuying: "Achat",
                interestSelling: "Vente",
                interestNetworking: "Réseautage",
                interestResearch: "Recherche",
                interestInvestment: "Investissement",
                interestEquipment: "Fourniture d'équipement",
                interestCollaboration: "Collaboration",
                notificationMethodLabel: "Méthode de notification préférée :",
                notificationEmail: "E-mail",
                notificationSMS: "SMS",
                notificationInApp: "Dans l'application",
                termsConsentHeader: "8. Termes & Consentement",
                agreeTermsText: "J'accepte les",
                termsOfServiceLink: "Conditions d'utilisation",
                agreePrivacyText: "J'accepte la",
                privacyPolicyLink: "Politique de confidentialité",
                dataVerificationText: "Je consens à la vérification des données",
                registerButtonText: "Créer un compte",
                alreadyAccountPrompt: "Vous avez déjà un compte ?",
                signInLink: "Connectez-vous",
                copyrightText: "Tous droits réservés.",
                loadingText: "Chargement...",
                acceptButtonText: "Accepter & Continuer",
                errorPasswordsMismatch: "Les mots de passe ne correspondent pas.",
                errorRegistrationFailed: "L'inscription a échoué :",
                successRegistration: "Inscription réussie ! Veuillez vérifier votre e-mail pour confirmer votre compte.",
                errorProfileSave: "Compte créé, mais les détails du profil n'ont pas pu être sauvegardés. Veuillez mettre à jour votre profil après vous être connecté.",
                errorUnexpected: "Une erreur inattendue est survenue. Veuillez réessayer.",
                loadingButtonText: "Création du compte...",
            },
            en: {
                pageTitle: "Register - Xeltis",
                createAccountHeader: "Create Your Xeltis Account",
                createAccountSubheader: "Join the Xeltis platform and be part of the future of mineral trading.",
                personalInfoHeader: "1. Personal Information",
                fullNameLabel: "Full Name",
                placeholderFullName: "John Doe",
                emailLabel: "Email Address",
                placeholderEmail: "you@example.com",
                phoneNumberLabel: "Phone Number",
                placeholderPhoneNumber: "+1234567890",
                countryLabel: "Country / Region",
                placeholderCountry: "Select your country",
                cityLabel: "City / Town",
                placeholderCity: "e.g., Johannesburg",
                dateOfBirthLabel: "Date of Birth",
                accountSecurityHeader: "2. Account Security",
                passwordLabel: "Create Password",
                placeholderPassword: "Enter a strong password",
                confirmPasswordLabel: "Confirm Password",
                placeholderConfirmPassword: "Confirm your password",
                idPassportLabel: "Upload ID/Passport (for verification)",
                idPassportHelp: "Accepted formats: images (.jpg, .png) or PDF. Max size 5MB.",
                miningRoleHeader: "3. Mining Role / Profile",
                miningRolesLabel: "Please select your role in the mining industry",
                placeholderMiningRoles: "Select a role...",
                miningRoles: [
                    "Artisanal Miner",
                    "Industrial/International Mining Company",
                    "Local Mining Company",
                    "Geologist / Researcher",
                    "Equipment Supplier",
                    "Investor / Financier",
                    "Logistics / Transport Provider",
                    "Regulatory / Government Official"
                ],
                companyDetailsHeader: "4. Company / Organization Details",
                optionalText: "(if applicable)",
                companyNameLabel: "Company/Organization Name",
                placeholderCompanyName: "e.g., GeoMining Corp",
                companyTypeLabel: "Type",
                placeholderSelectType: "Select type",
                companyTypePrivate: "Private",
                companyTypePublic: "Public",
                companyTypeNGO: "NGO",
                companyTypeGovernment: "Government",
                companyTypeOther: "Other",
                countryOfOperationLabel: "Country of Operation",
                placeholderCountryOfOperation: "Select country of operation",
                numEmployeesLabel: "Number of Employees",
                placeholderNumEmployees: "e.g., 50",
                companyWebsiteLabel: "Website",
                miningActivityHeader: "5. Mining Activity Details",
                mineralsExtractedLabel: "Type of Minerals Extracted / Interested In",
                placeholderMineralsExtracted: "e.g., Gold, Copper, Lithium",
                operationsLocationLabel: "Location(s) of Operations",
                placeholderOperationsLocation: "e.g., GPS coordinates or region",
                annualProductionLabel: "Annual Production / Investment Capacity",
                placeholderAnnualProduction: "e.g., 500 kg per year",
                equipmentUsedLabel: "Equipment Owned / Used",
                placeholderEquipmentUsed: "e.g., Excavators, drills",
                experienceExpertiseHeader: "6. Experience & Expertise",
                yearsInSectorLabel: "Years in Mining Sector",
                placeholderYearsInSector: "e.g., 5",
                licensesLabel: "Certifications / Licenses",
                placeholderLicenses: "e.g., Mine Manager Certificate",
                expertiseLabel: "Areas of Expertise",
                placeholderExpertise: "e.g., Exploration, Extraction, Logistics",
                interestsHeader: "7. Interests & Platform Use",
                interestedInLabel: "Interested in:",
                interestBuying: "Buying",
                interestSelling: "Selling",
                interestNetworking: "Networking",
                interestResearch: "Research",
                interestInvestment: "Investment",
                interestEquipment: "Equipment Supply",
                interestCollaboration: "Collaboration",
                notificationMethodLabel: "Preferred Notification Method:",
                notificationEmail: "Email",
                notificationSMS: "SMS",
                notificationInApp: "In-App",
                termsConsentHeader: "8. Terms & Consent",
                agreeTermsText: "I accept the",
                termsOfServiceLink: "Terms & Conditions",
                agreePrivacyText: "I accept the",
                privacyPolicyLink: "Privacy Policy",
                dataVerificationText: "I consent to data verification",
                registerButtonText: "Create Account",
                alreadyAccountPrompt: "Already have an account?",
                signInLink: "Sign in",
                copyrightText: "All rights reserved.",
                loadingText: "Loading...",
                acceptButtonText: "Accept & Continue",
                errorPasswordsMismatch: "Passwords do not match.",
                errorRegistrationFailed: "Registration failed:",
                successRegistration: "Registered successfully! Please check your email to confirm your account.",
                errorProfileSave: "Account created, but profile details failed to save. Please update your profile after logging in.",
                errorUnexpected: "An unexpected error occurred. Please try again.",
                loadingButtonText: "Creating Account...",
            }
        };

        const countriesList = [
            "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan",
            "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi",
            "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo (Congo-Brazzaville)", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czechia (Czech Republic)",
            "Democratic Republic of the Congo", "Denmark", "Djibouti", "Dominica", "Dominican Republic",
            "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini (fmr. 'Swaziland')", "Ethiopia",
            "Fiji", "Finland", "France",
            "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana",
            "Haiti", "Holy See", "Honduras", "Hungary",
            "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy",
            "Jamaica", "Japan", "Jordan",
            "Kazakhstan", "Kenya", "Kiribati", "Kuwait", "Kyrgyzstan",
            "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg",
            "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar (fmr. Burma)",
            "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Korea", "North Macedonia (fmr. Macedonia)", "Norway",
            "Oman",
            "Pakistan", "Palau", "Palestine State", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal",
            "Qatar",
            "Romania", "Russia", "Rwanda",
            "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria",
            "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu",
            "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States of America", "Uruguay", "Uzbekistan",
            "Vanuatu", "Venezuela", "Vietnam",
            "Yemen",
            "Zambia", "Zimbabwe"
        ];

        let currentLang = 'fr';

        function getLanguage() {
            const params = new URLSearchParams(window.location.search);
            const lang = params.get('lang');
            if (lang) {
                localStorage.setItem('lang', lang);
                return lang;
            }
            return localStorage.getItem('lang') || 'fr';
        }

        function populateCountryDropdowns() {
            const countrySelect = document.getElementById('country');
            const countryOfOperationSelect = document.getElementById('countryOfOperation');

            countriesList.forEach(country => {
                const option1 = document.createElement('option');
                option1.value = country;
                option1.textContent = country;
                countrySelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = country;
                option2.textContent = country;
                countryOfOperationSelect.appendChild(option2);
            });
        }

        function populateMiningRolesDropdown() {
            const miningRoleSelect = document.getElementById('miningRole');
            miningRoleSelect.innerHTML = `<option value="" disabled selected data-i18n="placeholderMiningRoles">${translations[currentLang].placeholderMiningRoles}</option>`;
            
            translations.en.miningRoles.forEach((roleValue, index) => {
                const option = document.createElement('option');
                option.value = roleValue;
                option.textContent = translations[currentLang].miningRoles[index];
                miningRoleSelect.appendChild(option);
            });
        }

        function applyTranslations(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) {
                    const translation = translations[lang][key];
                    if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                        element.placeholder = translation;
                    } else if (element.tagName === 'OPTION') {
                        element.textContent = translation;
                    } else {
                        element.textContent = translation;
                    }
                }
            });

            const placeholderFields = {
                fullName: 'placeholderFullName',
                email: 'placeholderEmail',
                phoneNumber: 'placeholderPhoneNumber',
                city: 'placeholderCity',
                password: 'placeholderPassword',
                confirmPassword: 'placeholderConfirmPassword',
                companyName: 'placeholderCompanyName',
                numEmployees: 'placeholderNumEmployees',
                mineralsExtracted: 'placeholderMineralsExtracted',
                operationsLocation: 'placeholderOperationsLocation',
                annualProduction: 'placeholderAnnualProduction',
                equipmentUsed: 'placeholderEquipmentUsed',
                yearsInSector: 'placeholderYearsInSector',
                licenses: 'placeholderLicenses',
                expertise: 'placeholderExpertise',
            };

            for (const id in placeholderFields) {
                const element = document.getElementById(id);
                if (element && translations[lang] && translations[lang][placeholderFields[id]]) {
                    element.placeholder = translations[lang][placeholderFields[id]];
                }
            }
            
            populateMiningRolesDropdown();

            const langSelector = document.getElementById('languageSelector');
            if (langSelector) {
                langSelector.textContent = lang.toUpperCase() === 'FR' ? 'EN' : 'FR';
                document.documentElement.lang = lang;
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            populateCountryDropdowns();
            applyTranslations(getLanguage());

            const currentYearSpan = document.getElementById("currentYear");
            if (currentYearSpan) {
                currentYearSpan.textContent = new Date().getFullYear();
            }

            const SUPABASE_URL = 'https://qudbehodnhevjxmdwvta.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF1ZGJlaG9kbmhldmp4bWR3dnRhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ1MjExODksImV4cCI6MjA3MDA5NzE4OX0.YnK8UKd76PBLh3L0zAv5fY0JFK6EWq-UBHLY8jXz55w';
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            const registrationForm = document.getElementById('registrationForm');
            const registerButton = document.getElementById('registerButton');
            const messageBox = document.getElementById('messageBox');
            const companyDetailsSection = document.getElementById('companyDetailsSection');
            const miningRoleSelect = document.getElementById('miningRole');
            
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');
            const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');

            function toggleVisibility(input, toggle) {
                const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                input.setAttribute('type', type);
                toggle.innerHTML = type === 'password' ? '<i class="fa-solid fa-eye-slash"></i>' : '<i class="fa-solid fa-eye"></i>';
            }
            togglePassword.addEventListener('click', () => toggleVisibility(passwordInput, togglePassword));
            toggleConfirmPassword.addEventListener('click', () => toggleVisibility(confirmPasswordInput, toggleConfirmPassword));

            function showMessage(message, type) {
                messageBox.textContent = message;
                messageBox.className = `message-box ${type}`;
                messageBox.classList.remove('hidden');
            }

            const policyModal = document.getElementById('policyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            const modalAcceptBtn = document.getElementById('modalAcceptBtn');
            let currentCheckboxToUpdate = null;

            async function openPolicyModal(titleKey, url, checkboxElement) {
                modalTitle.textContent = translations[currentLang][titleKey];
                modalBody.innerHTML = `<p class="text-center text-gray-500">${translations[currentLang].loadingText}</p>`;
                policyModal.classList.add('open');
                currentCheckboxToUpdate = checkboxElement;

                try {
                    const response = await fetch(url);
                    if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); }
                    const htmlContent = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(htmlContent, 'text/html');
                    const mainContent = doc.querySelector('.container');
                    if (mainContent) {
                        modalBody.innerHTML = mainContent.innerHTML;
                    } else {
                        modalBody.innerHTML = `<p class="text-red-500 text-center">Failed to load policy content.</p>`;
                    }
                } catch (error) {
                    console.error(`Failed to load policy from ${url}:`, error);
                    modalBody.innerHTML = `<p class="text-red-500 text-center">Failed to load policy content.</p>`;
                }
            }

            document.getElementById('viewTerms').addEventListener('click', function(e) {
                e.preventDefault();
                const termsUrl = currentLang === 'fr' ? 'terms-of-service.html' : 'terms-of-service_en.html';
                openPolicyModal('termsOfServiceLink', termsUrl, document.getElementById('agreeTerms'));
            });

            document.getElementById('viewPrivacy').addEventListener('click', function(e) {
                e.preventDefault();
                const privacyUrl = currentLang === 'fr' ? 'privacy-policy.html' : 'privacy-policy_en.html';
                openPolicyModal('privacyPolicyLink', privacyUrl, document.getElementById('agreePrivacy'));
            });

            modalAcceptBtn.addEventListener('click', function() {
                if (currentCheckboxToUpdate) {
                    currentCheckboxToUpdate.checked = true;
                }
                policyModal.classList.remove('open');
            });
            
            const rolesRequiringCompanyDetails = [
                "Industrial/International Mining Company",
                "Local Mining Company",
                "Equipment Supplier",
                "Investor / Financier",
                "Logistics / Transport Provider",
                "Regulatory / Government Official"
            ];
            
            miningRoleSelect.addEventListener('change', (e) => {
                const selectedRole = e.target.value;
                if (rolesRequiringCompanyDetails.includes(selectedRole)) {
                    companyDetailsSection.classList.remove('hidden');
                } else {
                    companyDetailsSection.classList.add('hidden');
                }
            });

            const langSelector = document.getElementById('languageSelector');
            if (langSelector) {
                langSelector.addEventListener('click', () => {
                    const newLang = currentLang === 'fr' ? 'en' : 'fr';
                    localStorage.setItem('lang', newLang);
                    window.location.href = `register.html?lang=${newLang}`;
                });
            }

            registrationForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                messageBox.classList.add('hidden');
                registerButton.disabled = true;
                registerButton.textContent = translations[currentLang].loadingButtonText;
                
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;
                if (password !== confirmPassword) {
                    showMessage(translations[currentLang].errorPasswordsMismatch, 'error');
                    registerButton.disabled = false;
                    registerButton.textContent = translations[currentLang].registerButtonText;
                    return;
                }

                const formData = {
                    full_name: document.getElementById('fullName').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    phone_number: document.getElementById('phoneNumber').value.trim(),
                    city: document.getElementById('city').value.trim(),
                    country: document.getElementById('country').value,
                    date_of_birth: document.getElementById('dateOfBirth').value,
                    mining_role: document.getElementById('miningRole').value,
                    company_name: document.getElementById('companyName').value.trim(),
                    company_type: document.getElementById('companyType').value,
                    country_of_operation: document.getElementById('countryOfOperation').value,
                    num_employees: document.getElementById('numEmployees').value,
                    company_website: document.getElementById('companyWebsite').value.trim(),
                    minerals_extracted: document.getElementById('mineralsExtracted').value.trim(),
                    operations_location: document.getElementById('operationsLocation').value.trim(),
                    annual_production: document.getElementById('annualProduction').value.trim(),
                    equipment_used: document.getElementById('equipmentUsed').value.trim(),
                    years_in_sector: document.getElementById('yearsInSector').value,
                    licenses: document.getElementById('licenses').value.trim(),
                    expertise: document.getElementById('expertise').value.trim(),
                    interests: Array.from(document.querySelectorAll('input[name="interest"]:checked')).map(el => el.value),
                    notification_method: document.querySelector('input[name="notificationMethod"]:checked')?.value,
                    agree_privacy: document.getElementById('agreePrivacy').checked,
                    agree_terms: document.getElementById('agreeTerms').checked,
                    data_verification: document.getElementById('dataVerification').checked
                };

                try {
                    const { data, error } = await supabase.auth.signUp({
                        email: formData.email,
                        password: password,
                        options: {
                            data: formData,
                            emailRedirectTo: `${window.location.origin}/login.html`
                        }
                    });

                    if (error) {
                        console.error('Registration Error:', error);
                        showMessage(`${translations[currentLang].errorRegistrationFailed} ${error.message}`, 'error');
                        registerButton.disabled = false;
                        registerButton.textContent = translations[currentLang].registerButtonText;
                    } else {
                        console.log('Registration successful:', data);
                        showMessage(translations[currentLang].successRegistration, 'success');
                        setTimeout(() => {
                            window.location.href = `login.html?lang=${currentLang}`;
                        }, 3000);
                    }
                } catch (error) {
                    console.error('Unexpected error:', error);
                    showMessage(translations[currentLang].errorUnexpected, 'error');
                    registerButton.disabled = false;
                    registerButton.textContent = translations[currentLang].registerButtonText;
                }
            });
        });
    </script>
</body>
</html>